{"cells":[{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":73,"resources":{"http://localhost:8080/nbextensions/google.colab/files.js":{"data":"Ly8gQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQwovLwovLyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKLy8geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgovLyBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKLy8KLy8gICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKLy8KLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQovLyBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAovLyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KLy8gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAovLyBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCi8qKgogKiBAZmlsZW92ZXJ2aWV3IEhlbHBlcnMgZm9yIGdvb2dsZS5jb2xhYiBQeXRob24gbW9kdWxlLgogKi8KKGZ1bmN0aW9uKHNjb3BlKSB7CmZ1bmN0aW9uIHNwYW4odGV4dCwgc3R5bGVBdHRyaWJ1dGVzID0ge30pIHsKICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogIGVsZW1lbnQudGV4dENvbnRlbnQgPSB0ZXh0OwogIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKHN0eWxlQXR0cmlidXRlcykpIHsKICAgIGVsZW1lbnQuc3R5bGVba2V5XSA9IHN0eWxlQXR0cmlidXRlc1trZXldOwogIH0KICByZXR1cm4gZWxlbWVudDsKfQoKLy8gTWF4IG51bWJlciBvZiBieXRlcyB3aGljaCB3aWxsIGJlIHVwbG9hZGVkIGF0IGEgdGltZS4KY29uc3QgTUFYX1BBWUxPQURfU0laRSA9IDEwMCAqIDEwMjQ7CgpmdW5jdGlvbiBfdXBsb2FkRmlsZXMoaW5wdXRJZCwgb3V0cHV0SWQpIHsKICBjb25zdCBzdGVwcyA9IHVwbG9hZEZpbGVzU3RlcChpbnB1dElkLCBvdXRwdXRJZCk7CiAgY29uc3Qgb3V0cHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG91dHB1dElkKTsKICAvLyBDYWNoZSBzdGVwcyBvbiB0aGUgb3V0cHV0RWxlbWVudCB0byBtYWtlIGl0IGF2YWlsYWJsZSBmb3IgdGhlIG5leHQgY2FsbAogIC8vIHRvIHVwbG9hZEZpbGVzQ29udGludWUgZnJvbSBQeXRob24uCiAgb3V0cHV0RWxlbWVudC5zdGVwcyA9IHN0ZXBzOwoKICByZXR1cm4gX3VwbG9hZEZpbGVzQ29udGludWUob3V0cHV0SWQpOwp9CgovLyBUaGlzIGlzIHJvdWdobHkgYW4gYXN5bmMgZ2VuZXJhdG9yIChub3Qgc3VwcG9ydGVkIGluIHRoZSBicm93c2VyIHlldCksCi8vIHdoZXJlIHRoZXJlIGFyZSBtdWx0aXBsZSBhc3luY2hyb25vdXMgc3RlcHMgYW5kIHRoZSBQeXRob24gc2lkZSBpcyBnb2luZwovLyB0byBwb2xsIGZvciBjb21wbGV0aW9uIG9mIGVhY2ggc3RlcC4KLy8gVGhpcyB1c2VzIGEgUHJvbWlzZSB0byBibG9jayB0aGUgcHl0aG9uIHNpZGUgb24gY29tcGxldGlvbiBvZiBlYWNoIHN0ZXAsCi8vIHRoZW4gcGFzc2VzIHRoZSByZXN1bHQgb2YgdGhlIHByZXZpb3VzIHN0ZXAgYXMgdGhlIGlucHV0IHRvIHRoZSBuZXh0IHN0ZXAuCmZ1bmN0aW9uIF91cGxvYWRGaWxlc0NvbnRpbnVlKG91dHB1dElkKSB7CiAgY29uc3Qgb3V0cHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG91dHB1dElkKTsKICBjb25zdCBzdGVwcyA9IG91dHB1dEVsZW1lbnQuc3RlcHM7CgogIGNvbnN0IG5leHQgPSBzdGVwcy5uZXh0KG91dHB1dEVsZW1lbnQubGFzdFByb21pc2VWYWx1ZSk7CiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXh0LnZhbHVlLnByb21pc2UpLnRoZW4oKHZhbHVlKSA9PiB7CiAgICAvLyBDYWNoZSB0aGUgbGFzdCBwcm9taXNlIHZhbHVlIHRvIG1ha2UgaXQgYXZhaWxhYmxlIHRvIHRoZSBuZXh0CiAgICAvLyBzdGVwIG9mIHRoZSBnZW5lcmF0b3IuCiAgICBvdXRwdXRFbGVtZW50Lmxhc3RQcm9taXNlVmFsdWUgPSB2YWx1ZTsKICAgIHJldHVybiBuZXh0LnZhbHVlLnJlc3BvbnNlOwogIH0pOwp9CgovKioKICogR2VuZXJhdG9yIGZ1bmN0aW9uIHdoaWNoIGlzIGNhbGxlZCBiZXR3ZWVuIGVhY2ggYXN5bmMgc3RlcCBvZiB0aGUgdXBsb2FkCiAqIHByb2Nlc3MuCiAqIEBwYXJhbSB7c3RyaW5nfSBpbnB1dElkIEVsZW1lbnQgSUQgb2YgdGhlIGlucHV0IGZpbGUgcGlja2VyIGVsZW1lbnQuCiAqIEBwYXJhbSB7c3RyaW5nfSBvdXRwdXRJZCBFbGVtZW50IElEIG9mIHRoZSBvdXRwdXQgZGlzcGxheS4KICogQHJldHVybiB7IUl0ZXJhYmxlPCFPYmplY3Q+fSBJdGVyYWJsZSBvZiBuZXh0IHN0ZXBzLgogKi8KZnVuY3Rpb24qIHVwbG9hZEZpbGVzU3RlcChpbnB1dElkLCBvdXRwdXRJZCkgewogIGNvbnN0IGlucHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlucHV0SWQpOwogIGlucHV0RWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlOwoKICBjb25zdCBvdXRwdXRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3V0cHV0SWQpOwogIG91dHB1dEVsZW1lbnQuaW5uZXJIVE1MID0gJyc7CgogIGNvbnN0IHBpY2tlZFByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7CiAgICAgIHJlc29sdmUoZS50YXJnZXQuZmlsZXMpOwogICAgfSk7CiAgfSk7CgogIGNvbnN0IGNhbmNlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogIGlucHV0RWxlbWVudC5wYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKGNhbmNlbCk7CiAgY2FuY2VsLnRleHRDb250ZW50ID0gJ0NhbmNlbCB1cGxvYWQnOwogIGNvbnN0IGNhbmNlbFByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgY2FuY2VsLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgIHJlc29sdmUobnVsbCk7CiAgICB9OwogIH0pOwoKICAvLyBXYWl0IGZvciB0aGUgdXNlciB0byBwaWNrIHRoZSBmaWxlcy4KICBjb25zdCBmaWxlcyA9IHlpZWxkIHsKICAgIHByb21pc2U6IFByb21pc2UucmFjZShbcGlja2VkUHJvbWlzZSwgY2FuY2VsUHJvbWlzZV0pLAogICAgcmVzcG9uc2U6IHsKICAgICAgYWN0aW9uOiAnc3RhcnRpbmcnLAogICAgfQogIH07CgogIGNhbmNlbC5yZW1vdmUoKTsKCiAgLy8gRGlzYWJsZSB0aGUgaW5wdXQgZWxlbWVudCBzaW5jZSBmdXJ0aGVyIHBpY2tzIGFyZSBub3QgYWxsb3dlZC4KICBpbnB1dEVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlOwoKICBpZiAoIWZpbGVzKSB7CiAgICByZXR1cm4gewogICAgICByZXNwb25zZTogewogICAgICAgIGFjdGlvbjogJ2NvbXBsZXRlJywKICAgICAgfQogICAgfTsKICB9CgogIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykgewogICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpOwogICAgbGkuYXBwZW5kKHNwYW4oZmlsZS5uYW1lLCB7Zm9udFdlaWdodDogJ2JvbGQnfSkpOwogICAgbGkuYXBwZW5kKHNwYW4oCiAgICAgICAgYCgke2ZpbGUudHlwZSB8fCAnbi9hJ30pIC0gJHtmaWxlLnNpemV9IGJ5dGVzLCBgICsKICAgICAgICBgbGFzdCBtb2RpZmllZDogJHsKICAgICAgICAgICAgZmlsZS5sYXN0TW9kaWZpZWREYXRlID8gZmlsZS5sYXN0TW9kaWZpZWREYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygpIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ24vYSd9IC0gYCkpOwogICAgY29uc3QgcGVyY2VudCA9IHNwYW4oJzAlIGRvbmUnKTsKICAgIGxpLmFwcGVuZENoaWxkKHBlcmNlbnQpOwoKICAgIG91dHB1dEVsZW1lbnQuYXBwZW5kQ2hpbGQobGkpOwoKICAgIGNvbnN0IGZpbGVEYXRhUHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZSkgPT4gewogICAgICAgIHJlc29sdmUoZS50YXJnZXQucmVzdWx0KTsKICAgICAgfTsKICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGUpOwogICAgfSk7CiAgICAvLyBXYWl0IGZvciB0aGUgZGF0YSB0byBiZSByZWFkeS4KICAgIGxldCBmaWxlRGF0YSA9IHlpZWxkIHsKICAgICAgcHJvbWlzZTogZmlsZURhdGFQcm9taXNlLAogICAgICByZXNwb25zZTogewogICAgICAgIGFjdGlvbjogJ2NvbnRpbnVlJywKICAgICAgfQogICAgfTsKCiAgICAvLyBVc2UgYSBjaHVua2VkIHNlbmRpbmcgdG8gYXZvaWQgbWVzc2FnZSBzaXplIGxpbWl0cy4gU2VlIGIvNjIxMTU2NjAuCiAgICBsZXQgcG9zaXRpb24gPSAwOwogICAgZG8gewogICAgICBjb25zdCBsZW5ndGggPSBNYXRoLm1pbihmaWxlRGF0YS5ieXRlTGVuZ3RoIC0gcG9zaXRpb24sIE1BWF9QQVlMT0FEX1NJWkUpOwogICAgICBjb25zdCBjaHVuayA9IG5ldyBVaW50OEFycmF5KGZpbGVEYXRhLCBwb3NpdGlvbiwgbGVuZ3RoKTsKICAgICAgcG9zaXRpb24gKz0gbGVuZ3RoOwoKICAgICAgY29uc3QgYmFzZTY0ID0gYnRvYShTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGNodW5rKSk7CiAgICAgIHlpZWxkIHsKICAgICAgICByZXNwb25zZTogewogICAgICAgICAgYWN0aW9uOiAnYXBwZW5kJywKICAgICAgICAgIGZpbGU6IGZpbGUubmFtZSwKICAgICAgICAgIGRhdGE6IGJhc2U2NCwKICAgICAgICB9LAogICAgICB9OwoKICAgICAgbGV0IHBlcmNlbnREb25lID0gZmlsZURhdGEuYnl0ZUxlbmd0aCA9PT0gMCA/CiAgICAgICAgICAxMDAgOgogICAgICAgICAgTWF0aC5yb3VuZCgocG9zaXRpb24gLyBmaWxlRGF0YS5ieXRlTGVuZ3RoKSAqIDEwMCk7CiAgICAgIHBlcmNlbnQudGV4dENvbnRlbnQgPSBgJHtwZXJjZW50RG9uZX0lIGRvbmVgOwoKICAgIH0gd2hpbGUgKHBvc2l0aW9uIDwgZmlsZURhdGEuYnl0ZUxlbmd0aCk7CiAgfQoKICAvLyBBbGwgZG9uZS4KICB5aWVsZCB7CiAgICByZXNwb25zZTogewogICAgICBhY3Rpb246ICdjb21wbGV0ZScsCiAgICB9CiAgfTsKfQoKc2NvcGUuZ29vZ2xlID0gc2NvcGUuZ29vZ2xlIHx8IHt9OwpzY29wZS5nb29nbGUuY29sYWIgPSBzY29wZS5nb29nbGUuY29sYWIgfHwge307CnNjb3BlLmdvb2dsZS5jb2xhYi5fZmlsZXMgPSB7CiAgX3VwbG9hZEZpbGVzLAogIF91cGxvYWRGaWxlc0NvbnRpbnVlLAp9Owp9KShzZWxmKTsK","headers":[["content-type","application/javascript"]],"ok":true,"status":200,"status_text":""}}},"id":"PZCFJZaZsjW6","executionInfo":{"status":"ok","timestamp":1647009281097,"user_tz":0,"elapsed":10279,"user":{"displayName":"Madhan Rajan","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"11949160929832065290"}},"outputId":"2f73d0ad-f9bd-4f6d-f197-485a50e2906b"},"outputs":[{"output_type":"display_data","data":{"text/html":["\n","     <input type=\"file\" id=\"files-38562444-be64-40a3-9e5c-1a5272dae4b7\" name=\"files[]\" multiple disabled\n","        style=\"border:none\" />\n","     <output id=\"result-38562444-be64-40a3-9e5c-1a5272dae4b7\">\n","      Upload widget is only available when the cell has been executed in the\n","      current browser session. Please rerun this cell to enable.\n","      </output>\n","      <script src=\"/nbextensions/google.colab/files.js\"></script> "],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{}},{"output_type":"stream","name":"stdout","text":["Saving interpolated_array.npy to interpolated_array.npy\n"]}],"source":["from google.colab import files\n","\n","fl = files.upload()\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"l3tpMHivs-GZ"},"outputs":[],"source":["\n","import numpy as np\n","\n","irf = np.load(\"interpolated_array.npy\")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"84-3c5b7mLPS"},"outputs":[],"source":["import matplotlib.pyplot as plt\n","import scipy.stats as stats\n","import math\n","\n","density = 1000\n","\n","def generate_gaussian():\n","    \n","    x = np.array(range(density))\n","    y = irf\n","\n","    return (x,y)\n","\n","\n","\n","def f(x,a,tau):\n","    return a * np.exp(-x/tau)\n","\n","\n","def generate_decay_curve(low_a=0.1,high_a=1,low_tau=1,high_tau=50):\n","    a = np.random.uniform(low=low_a,high=high_a)\n","    tau = np.random.uniform(low=low_tau,high=high_tau)\n","    x = np.array(range(density))\n","    y = f(x,a,tau)\n","\n","    return (y,a,tau)\n","\n","def generate_decay_curve(low_a=0.1,high_a=1,low_tau=1,high_tau=50):\n","    a = np.random.uniform(low=low_a,high=high_a)\n","    tau = np.random.uniform(low=low_tau,high=high_tau)\n","    x = np.array(range(density))\n","    y = f(x,a,tau)\n","\n","    return (y,a,tau)\n","    \n","\n","def generate_dataset_one():\n","    (x,y) = generate_gaussian()\n","    (dec_y,a,t) = generate_decay_curve()\n","    z = np.convolve(y,dec_y)[:density]\n","    # z += np.random.uniform(0,0.2)\n","    z = z + np.random.uniform(low=-z/5,high=z/5,size=density)\n","\n","\n","    t = t/100\n","\n","    input = np.concatenate((z,y))\n","    output = np.array((a,t,0,0,0,0))\n","\n","    return (input,output)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"lPzB6AjSW1u9"},"outputs":[],"source":["def generate_dataset_two():\n","    (x,y) = generate_gaussian()\n","    \n","\n","    (dec_y,a,t) = generate_decay_curve(low_tau=0.1,high_tau=10)\n","    (dec_y_2,a2,t2) = generate_decay_curve(low_tau=10.1,high_tau=100)\n","\n","    t = t/10\n","    t2 = t2/100\n","\n","    new_dec = dec_y + dec_y_2\n","\n","    z = np.convolve(y,new_dec)[:density]\n","    # z += np.random.uniform(0,0.2)\n","    z = z + np.random.uniform(low=-z/5,high=z/5,size=density)\n","\n","\n","    input = np.concatenate((z,y))\n","    output = np.array((a,t,a2,t2,0,0))\n","    output = np.array([t,t2,0])\n","    # output = output.reshape(3)\n","\n","    return (input,output)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Q9y1bMKtXy22"},"outputs":[],"source":["def generate_dataset_three():\n","    (x,y) = generate_gaussian()\n","    (dec_y,a,t) = generate_decay_curve(low_tau=0.1,high_tau=2)\n","    (dec_y_2,a2,t2) = generate_decay_curve(low_tau=2,high_tau=10)\n","    (dec_y_3,a3,t3) = generate_decay_curve(low_tau=10,high_tau=100)\n","    \n","\n","    t = t/2\n","    t2 = t2/10\n","    t3 = t3/100\n","\n","    new_dec = dec_y + dec_y_2 + dec_y_3\n","\n","    z = np.convolve(y,new_dec)[:density]\n","    z = z + np.random.uniform(low=-z/5,high=z/5,size=density)\n","\n","\n","    input = np.concatenate((z,y))\n","    output = np.array([t,t2,t3])\n","    # output = np.array([output[0][0],output[1][0],output[2][0],output[0][1],output[1][1],output[2][1]])\n","    # output = output.reshape(6)\n","\n","    return (input,output)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"EbR3K0p8mUF8"},"outputs":[],"source":["\n","x_list = []\n","y_list = []\n","for i in range(100000):\n","\n","  \n","    # (x,y) = generate_dataset_one()\n","    \n","    # x_list.append(x)\n","    # y_list.append(y)\n","\n","    (x,y) = generate_dataset_three()\n","\n","    \n","    \n","    x_list.append(x)\n","    y_list.append(y)\n","\n","    # (x,y) = generate_dataset_three()\n","    \n","    # x_list.append(x)\n","    # y_list.append(y)\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":177,"status":"ok","timestamp":1647009381871,"user":{"displayName":"Madhan Rajan","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"11949160929832065290"},"user_tz":0},"id":"PCLMVIBvxt_B","outputId":"12a6e83a-3187-4f26-e2fe-0cc46f6a5d35"},"outputs":[{"output_type":"stream","name":"stdout","text":["[0.53367566 0.53911081 0.76553648]\n"]}],"source":["print(y_list[2])"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"VTRWFQ8D4s1O"},"outputs":[],"source":["import tensorflow as tf\n","from sklearn.model_selection import train_test_split\n","import sklearn\n","\n","x_list = np.array(x_list)\n","y_list = np.array(y_list)\n","\n","\n","# x_list = np.log(x_list)\n","\n","x_list, y_list = sklearn.utils.shuffle(x_list,y_list)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"hbgNkuaAm4RA"},"outputs":[],"source":["\n","\n","\n","# import matplotlib.pyplot as plt\n","\n","# x = np.array(range(density))\n","# plt.plot(x,x_list[0][:density])\n","# plt.plot(x,x_list[0][density:])\n","\n","\n","# # a = y_list[0][0]\n","# tau = y_list[0][0]\n","# # a2 = y_list[0][2]\n","# tau2 = y_list[0][1]\n","# # a3 = y_list[0][4]\n","# tau3 = y_list[0][2]\n","\n","# print(a,a2,a3)\n","\n","\n","\n","# plt.plot(x,f(x,a,tau))\n","# plt.plot(x,f(x,a2,tau2))\n","# # plt.plot(x,f(x,a3,tau3))\n","# plt.show()\n","\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1846,"status":"ok","timestamp":1647009393463,"user":{"displayName":"Madhan Rajan","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"11949160929832065290"},"user_tz":0},"id":"Khp6zsKhol2e","outputId":"9a313ee5-f7e2-485e-acfb-d572aa040f05"},"outputs":[{"output_type":"stream","name":"stdout","text":["(100000, 2000)\n","(100000, 3)\n"]}],"source":["\n","x_list = tf.keras.utils.normalize(x_list)\n","# y_list = tf.keras.utils.normalize(y_list)\n","\n","print(x_list.shape)\n","print(y_list.shape)\n","\n","\n","\n","\n","X_train, X_test, y_train, y_test = train_test_split(x_list, y_list, test_size=0.10, random_state=40)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"CPHyv5EymzWj"},"outputs":[],"source":["import keras\n","from tensorflow.keras.models import Sequential\n","from tensorflow.keras.layers import Dense, Dropout\n","from tensorflow.keras import layers\n","\n","\n","model = Sequential()\n","model.add(Dense(400, input_dim=density*2))\n","model.add(Dense(400, activation='relu'))\n","model.add(Dense(400, activation='relu'))\n","model.add(Dense(400, activation='relu'))\n","model.add(Dense(400, activation='relu'))\n","model.add(Dense(400, activation='relu'))\n","model.add(Dense(400, activation='relu'))\n","model.add(Dense(400, activation='relu'))\n","model.add(Dense(400, activation='relu'))\n","model.add(Dense(400, activation='relu'))\n","model.add(Dense(100, activation='relu'))\n","model.add(Dropout(0.5))\n","model.add(Dense(3, activation='relu'))"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"yY5ay5zMXyP8"},"outputs":[],"source":["def ftf(a,tau):\n","  return a*tf.math.exp(np.array(range(100))/tau)\n","\n","def error_function(y,y_real):\n","\n","  # a,tau = tf.split(y,num_or_size_of_splits=2,axis=1)\n","  # a_real,tau_real = tf.split(y,num_or_size_of_splits=2,axis=1)\n","\n","  return tf.math.reduce_sum(tf.math.abs(y-y_real))\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1381485,"status":"ok","timestamp":1647012827054,"user":{"displayName":"Madhan Rajan","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"11949160929832065290"},"user_tz":0},"id":"YPS1N9kGnRFI","outputId":"d7cf3fdd-2bb8-406d-9cbc-523fa53f4226"},"outputs":[{"output_type":"stream","name":"stdout","text":["Epoch 1/50\n","563/563 [==============================] - 29s 50ms/step - loss: 56.3402 - accuracy: 0.6603 - val_loss: 48.0914 - val_accuracy: 0.6812\n","Epoch 2/50\n","563/563 [==============================] - 27s 48ms/step - loss: 56.2114 - accuracy: 0.6613 - val_loss: 47.2673 - val_accuracy: 0.6876\n","Epoch 3/50\n","563/563 [==============================] - 28s 49ms/step - loss: 56.2847 - accuracy: 0.6605 - val_loss: 47.4913 - val_accuracy: 0.6809\n","Epoch 4/50\n","563/563 [==============================] - 27s 48ms/step - loss: 56.0172 - accuracy: 0.6615 - val_loss: 46.6545 - val_accuracy: 0.6857\n","Epoch 5/50\n","563/563 [==============================] - 27s 48ms/step - loss: 56.1025 - accuracy: 0.6593 - val_loss: 46.9933 - val_accuracy: 0.6874\n","Epoch 6/50\n","563/563 [==============================] - 27s 48ms/step - loss: 55.8969 - accuracy: 0.6591 - val_loss: 46.8927 - val_accuracy: 0.6845\n","Epoch 7/50\n","563/563 [==============================] - 27s 48ms/step - loss: 55.6347 - accuracy: 0.6618 - val_loss: 47.3925 - val_accuracy: 0.6852\n","Epoch 8/50\n","563/563 [==============================] - 27s 48ms/step - loss: 55.6808 - accuracy: 0.6609 - val_loss: 46.9113 - val_accuracy: 0.6886\n","Epoch 9/50\n","563/563 [==============================] - 27s 48ms/step - loss: 55.5385 - accuracy: 0.6636 - val_loss: 47.3389 - val_accuracy: 0.6853\n","Epoch 10/50\n","563/563 [==============================] - 27s 48ms/step - loss: 55.3625 - accuracy: 0.6626 - val_loss: 48.1779 - val_accuracy: 0.6827\n","Epoch 11/50\n","563/563 [==============================] - 27s 48ms/step - loss: 55.1843 - accuracy: 0.6625 - val_loss: 46.7389 - val_accuracy: 0.6888\n","Epoch 12/50\n","563/563 [==============================] - 27s 48ms/step - loss: 55.1029 - accuracy: 0.6632 - val_loss: 46.9118 - val_accuracy: 0.6834\n","Epoch 13/50\n","563/563 [==============================] - 27s 48ms/step - loss: 55.2453 - accuracy: 0.6635 - val_loss: 46.9600 - val_accuracy: 0.6862\n","Epoch 14/50\n","563/563 [==============================] - 27s 48ms/step - loss: 54.9224 - accuracy: 0.6631 - val_loss: 46.0813 - val_accuracy: 0.6863\n","Epoch 15/50\n","563/563 [==============================] - 27s 48ms/step - loss: 54.7567 - accuracy: 0.6661 - val_loss: 47.5336 - val_accuracy: 0.6751\n","Epoch 16/50\n","563/563 [==============================] - 27s 48ms/step - loss: 54.7053 - accuracy: 0.6643 - val_loss: 48.0985 - val_accuracy: 0.6756\n","Epoch 17/50\n","563/563 [==============================] - 27s 48ms/step - loss: 54.6756 - accuracy: 0.6658 - val_loss: 46.0337 - val_accuracy: 0.6902\n","Epoch 18/50\n","563/563 [==============================] - 27s 49ms/step - loss: 54.6275 - accuracy: 0.6639 - val_loss: 45.8838 - val_accuracy: 0.6913\n","Epoch 19/50\n","563/563 [==============================] - 27s 49ms/step - loss: 54.4373 - accuracy: 0.6664 - val_loss: 48.2614 - val_accuracy: 0.6786\n","Epoch 20/50\n","563/563 [==============================] - 28s 49ms/step - loss: 54.3346 - accuracy: 0.6668 - val_loss: 46.1603 - val_accuracy: 0.6894\n","Epoch 21/50\n","563/563 [==============================] - 27s 49ms/step - loss: 54.2141 - accuracy: 0.6680 - val_loss: 46.4239 - val_accuracy: 0.6796\n","Epoch 22/50\n","563/563 [==============================] - 28s 49ms/step - loss: 54.2317 - accuracy: 0.6671 - val_loss: 46.1967 - val_accuracy: 0.6879\n","Epoch 23/50\n","563/563 [==============================] - 27s 49ms/step - loss: 54.0263 - accuracy: 0.6680 - val_loss: 48.1882 - val_accuracy: 0.6746\n","Epoch 24/50\n","563/563 [==============================] - 28s 49ms/step - loss: 53.9509 - accuracy: 0.6687 - val_loss: 46.9844 - val_accuracy: 0.6851\n","Epoch 25/50\n","563/563 [==============================] - 28s 49ms/step - loss: 53.9380 - accuracy: 0.6665 - val_loss: 46.8816 - val_accuracy: 0.6841\n","Epoch 26/50\n","563/563 [==============================] - 28s 49ms/step - loss: 53.7853 - accuracy: 0.6680 - val_loss: 47.6483 - val_accuracy: 0.6784\n","Epoch 27/50\n","563/563 [==============================] - 27s 49ms/step - loss: 53.5759 - accuracy: 0.6710 - val_loss: 46.2068 - val_accuracy: 0.6897\n","Epoch 28/50\n","563/563 [==============================] - 28s 49ms/step - loss: 53.6520 - accuracy: 0.6695 - val_loss: 46.4590 - val_accuracy: 0.6895\n","Epoch 29/50\n","563/563 [==============================] - 28s 49ms/step - loss: 53.5682 - accuracy: 0.6705 - val_loss: 46.9724 - val_accuracy: 0.6900\n","Epoch 30/50\n","563/563 [==============================] - 28s 49ms/step - loss: 53.5491 - accuracy: 0.6706 - val_loss: 46.1894 - val_accuracy: 0.6974\n","Epoch 31/50\n","563/563 [==============================] - 28s 49ms/step - loss: 53.3725 - accuracy: 0.6705 - val_loss: 46.6960 - val_accuracy: 0.6948\n","Epoch 32/50\n","563/563 [==============================] - 28s 49ms/step - loss: 53.2303 - accuracy: 0.6723 - val_loss: 45.8976 - val_accuracy: 0.6912\n","Epoch 33/50\n","563/563 [==============================] - 28s 49ms/step - loss: 53.2352 - accuracy: 0.6712 - val_loss: 46.1367 - val_accuracy: 0.6901\n","Epoch 34/50\n","563/563 [==============================] - 28s 50ms/step - loss: 53.1146 - accuracy: 0.6733 - val_loss: 45.4150 - val_accuracy: 0.6953\n","Epoch 35/50\n","563/563 [==============================] - 28s 49ms/step - loss: 53.1506 - accuracy: 0.6708 - val_loss: 45.7641 - val_accuracy: 0.6951\n","Epoch 36/50\n","563/563 [==============================] - 28s 50ms/step - loss: 52.9931 - accuracy: 0.6720 - val_loss: 45.3972 - val_accuracy: 0.6967\n","Epoch 37/50\n","563/563 [==============================] - 28s 50ms/step - loss: 52.8140 - accuracy: 0.6711 - val_loss: 45.4053 - val_accuracy: 0.6944\n","Epoch 38/50\n","563/563 [==============================] - 28s 49ms/step - loss: 52.7798 - accuracy: 0.6726 - val_loss: 45.9571 - val_accuracy: 0.6899\n","Epoch 39/50\n","563/563 [==============================] - 28s 51ms/step - loss: 52.7033 - accuracy: 0.6734 - val_loss: 46.5645 - val_accuracy: 0.6737\n","Epoch 40/50\n","563/563 [==============================] - 29s 51ms/step - loss: 52.5984 - accuracy: 0.6756 - val_loss: 46.3800 - val_accuracy: 0.6804\n","Epoch 41/50\n","563/563 [==============================] - 29s 52ms/step - loss: 52.3795 - accuracy: 0.6769 - val_loss: 46.7909 - val_accuracy: 0.6957\n","Epoch 42/50\n","563/563 [==============================] - 30s 53ms/step - loss: 52.3567 - accuracy: 0.6745 - val_loss: 45.5050 - val_accuracy: 0.6948\n","Epoch 43/50\n","563/563 [==============================] - 28s 50ms/step - loss: 52.4275 - accuracy: 0.6744 - val_loss: 45.1832 - val_accuracy: 0.7002\n","Epoch 44/50\n","563/563 [==============================] - 28s 49ms/step - loss: 52.1977 - accuracy: 0.6757 - val_loss: 46.8609 - val_accuracy: 0.6673\n","Epoch 45/50\n","563/563 [==============================] - 27s 49ms/step - loss: 52.2820 - accuracy: 0.6754 - val_loss: 46.5268 - val_accuracy: 0.6894\n","Epoch 46/50\n","563/563 [==============================] - 27s 49ms/step - loss: 52.2540 - accuracy: 0.6789 - val_loss: 45.6695 - val_accuracy: 0.6899\n","Epoch 47/50\n","563/563 [==============================] - 28s 50ms/step - loss: 52.0477 - accuracy: 0.6776 - val_loss: 45.1297 - val_accuracy: 0.6999\n","Epoch 48/50\n","563/563 [==============================] - 28s 49ms/step - loss: 52.1009 - accuracy: 0.6769 - val_loss: 46.6398 - val_accuracy: 0.6936\n","Epoch 49/50\n","563/563 [==============================] - 27s 49ms/step - loss: 51.8630 - accuracy: 0.6794 - val_loss: 45.7753 - val_accuracy: 0.6937\n","Epoch 50/50\n","563/563 [==============================] - 28s 49ms/step - loss: 51.8521 - accuracy: 0.6789 - val_loss: 45.4240 - val_accuracy: 0.6962\n"]},{"output_type":"execute_result","data":{"text/plain":["<keras.callbacks.History at 0x7f3b4695f2d0>"]},"metadata":{},"execution_count":32}],"source":["model.compile(optimizer= tf.keras.optimizers.Adam(learning_rate=1e-5), loss=error_function, metrics=[\"accuracy\"])\n","model.fit(X_train, y_train, batch_size=128, epochs=50, validation_split=0.2)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"-TYn_kpdp8Nl"},"outputs":[],"source":["model.evaluate(X_test,y_test)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":73281,"status":"ok","timestamp":1647013075153,"user":{"displayName":"Madhan Rajan","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"11949160929832065290"},"user_tz":0},"id":"dhTzzYJX3oRA","outputId":"3a9e5cb5-3ec3-4bb3-bb9d-12c443e7b5ba"},"outputs":[{"output_type":"stream","name":"stdout","text":["[array([0.60570735, 0.20557308, 0.60759839]), array([0.11819725, 0.65201298, 0.35102529]), array([0.62646651, 0.51057156, 0.41895566]), array([0.49825187, 0.56057724, 0.30522439]), array([0.22129609, 0.83044878, 0.6554141 ])]\n"]}],"source":["m_list = []\n","n_list = []\n","for i in range(5):\n","  (m,n) = generate_dataset_three()\n","  m_list.append(m)\n","  n_list.append(n)\n","\n","\n","m = np.array(m_list)\n","m = tf.keras.utils.normalize(m)\n","# m = np.log(m)\n","n = np.array(n_list)\n","\n","print(n_list)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":257,"status":"ok","timestamp":1647012831278,"user":{"displayName":"Madhan Rajan","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"11949160929832065290"},"user_tz":0},"id":"aVo1WPRf35zp","outputId":"ff669c5b-d20b-4b34-e23a-ab0fd79cec37"},"outputs":[{"output_type":"stream","name":"stdout","text":["[[0.5120349  0.31563094 0.59231645]\n"," [0.31313    0.82667387 0.72074234]\n"," [0.5911884  0.7766205  0.4532123 ]\n"," [0.515255   0.65354776 0.86661977]\n"," [0.40630466 0.5386516  0.90562373]]\n"]}],"source":["\n","pred_n = model.predict(m)\n","print(pred_n)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"XeRYfRbZ4A4N"},"outputs":[],"source":["!mkdir -p saved_model"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"e0U6sNll8yw5"},"outputs":[],"source":["\n","model.save(\"gdrive/MyDrive/mymodel.h5\")"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":176,"status":"ok","timestamp":1647012997006,"user":{"displayName":"Madhan Rajan","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"11949160929832065290"},"user_tz":0},"id":"xghcU9wAE1Lu","outputId":"8a2b43a0-9d9a-4464-ea0a-4a73f751165c"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["['assets', 'variables', 'saved_model.pb', 'keras_metadata.pb']"]},"metadata":{},"execution_count":38}],"source":["import os\n","\n","os.listdir(\"saved_model/mymodel\")\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"wV8Pvwa9FXGn","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1647013346992,"user_tz":0,"elapsed":525,"user":{"displayName":"Madhan Rajan","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"11949160929832065290"}},"outputId":"ea059953-c9bc-47f3-fd5f-b504201ddcd1"},"outputs":[{"output_type":"stream","name":"stdout","text":["mymodel  mymodel.h5\n"]}],"source":["!ls saved_model/"]},{"cell_type":"code","source":["from google.colab import drive\n","drive.mount('/content/gdrive')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"gCXdo52yoLMp","executionInfo":{"status":"ok","timestamp":1647013598903,"user_tz":0,"elapsed":1690,"user":{"displayName":"Madhan Rajan","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"11949160929832065290"}},"outputId":"a65be406-9b06-4bab-d78b-d3823f5fe8c9"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Drive already mounted at /content/gdrive; to attempt to forcibly remount, call drive.mount(\"/content/gdrive\", force_remount=True).\n"]}]},{"cell_type":"code","source":["import os\n","\n","os.listdir(\"gdrive/MyDrive\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"5MAp2hupoqHE","executionInfo":{"status":"ok","timestamp":1647013612320,"user_tz":0,"elapsed":173,"user":{"displayName":"Madhan Rajan","photoUrl":"https://lh3.googleusercontent.com/a/default-user=s64","userId":"11949160929832065290"}},"outputId":"b6d40443-3a3d-4572-89b6-9e72fe9d9a0b"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["['Physics.pdf',\n"," '0081_Statement_Of_Entry.pdf',\n"," '0620_s10_qp_62.pdf',\n"," 'Contact Information.gform',\n"," 'Untitled spreadsheet.gsheet',\n"," 'Untitled document (9).gdoc',\n"," 'Google_Stock_Price_Train.gsheet',\n"," 'Untitled document (8).gdoc',\n"," 'Untitled document (7).gdoc',\n"," 'KCL Accommodation Offer - Madhanrajan.pdf',\n"," 'KCL Accommodation Offer - Madhanrajan.gdoc',\n"," 'KCL CAS Letter - Madhanrajan VARADHARAJAN.pdf',\n"," '2018_19 Residence Agreement.pdf',\n"," 'Student_Confirmation_of_Study_Letter_1852451.pdf',\n"," 'Startup Video',\n"," 'IMG_0376.JPG',\n"," 'Formula-sheet.pdf',\n"," 'FINAL Investigating the relationship between the period of simple  pendulum.docx',\n"," 'FINAL Investigating the relationship between the period of simple  pendulum.gdoc',\n"," 'Shian Housing Association website TEXT for HOME PAGE.docx',\n"," 'Shian Housing Association website TEXT for HOME PAGE.gdoc',\n"," \"Madhanrajan's Resume (1).pdf\",\n"," 'Gurantor Form.pdf',\n"," \"Madhan's Resume.pdf\",\n"," 'Untitled form.gform',\n"," 'Madhanrajan Varadharajan Reports Summary - 23andMe.pdf',\n"," 'Classroom',\n"," 'Advantage Education Malaysia.gform',\n"," 'snapshot2.jpg',\n"," 'snapshot2.png',\n"," \"Madhanrajan's Resume.pdf\",\n"," 'cold calling.gdoc',\n"," 'Untitled document (6).gdoc',\n"," 'stock.gdoc',\n"," 'stock2info.gdoc',\n"," 'stock2info.pdf',\n"," 'Untitled document (5).gdoc',\n"," 'Untitled document (4).gdoc',\n"," 'Trader Insight Pitch.gdoc',\n"," 'Untitled document (3).gdoc',\n"," 'Untitled document (2).gdoc',\n"," 'Untitled document (1).gdoc',\n"," '4 2 2021 .gdoc',\n"," 'Untitled document.gdoc',\n"," '8 2 2021.gdoc',\n"," 'ps2.docx',\n"," 'ps3.gdoc',\n"," 'Notability (2)',\n"," 'Notability (1)',\n"," 'Notability',\n"," 'Coversheet.docx',\n"," \"Madhanrajan's CV.pdf\",\n"," 'Curation',\n"," 'Colab Notebooks',\n"," 'Idea Factory 2022.docx']"]},"metadata":{},"execution_count":60}]},{"cell_type":"code","source":[""],"metadata":{"id":"VvddgbClqF4O"},"execution_count":null,"outputs":[]}],"metadata":{"accelerator":"TPU","colab":{"collapsed_sections":[],"name":"10 March","provenance":[{"file_id":"1dzyDXFpzavCg-8beUBTlvDa9fQx2L-Aa","timestamp":1646946949513},{"file_id":"1g1Lfc54hLeV-o7TRP7poHzXNGNCkWoBO","timestamp":1643579564167},{"file_id":"1d2bsw8hKS6LZCLOTy-u_0eiVvaFSznbd","timestamp":1643569030471}],"authorship_tag":"ABX9TyNejucSs0rztSDf64DctEXF"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}